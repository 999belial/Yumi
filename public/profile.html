<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>–û—Å–æ–±–∏—Å—Ç–∏–π –∫–∞–±—ñ–Ω–µ—Ç</title>
  <link rel="stylesheet" href="assets/css/style.css" />
</head>
<body>
  <div class="profile-container" style="padding: 2em; max-width: 600px; margin: auto; color: #fff;">
    <h1>üë§ –û—Å–æ–±–∏—Å—Ç–∏–π –∫–∞–±—ñ–Ω–µ—Ç</h1>
    <img id="avatar" src="assets/img/default.png" width="150" style="border-radius: 50%;" />

    <form id="profileForm">
      <label>–Ü–º‚Äô—è:</label>
      <input type="text" id="username" required />

      <label>Email:</label>
      <input type="email" id="email" />

      <label>–í—ñ–∫:</label>
      <input type="number" id="age" min="0" />

      <label>–°—Ç–∞—Ç—å:</label>
      <select id="gender">
        <option value="">-- –Ω–µ –≤–∫–∞–∑–∞–Ω–æ --</option>
        <option value="—á–æ–ª–æ–≤—ñ—á–∞">–ß–æ–ª–æ–≤—ñ—á–∞</option>
        <option value="–∂—ñ–Ω–æ—á–∞">–ñ—ñ–Ω–æ—á–∞</option>
        <option value="—ñ–Ω—à–µ">–Ü–Ω—à–µ</option>
      </select>

      <label>–£–ª—é–±–ª–µ–Ω–∏–π –∂–∞–Ω—Ä –∞–Ω—ñ–º–µ:</label>
      <input type="text" id="favorite" />

      <button type="submit">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏</button>
    </form>

    <button onclick="logout()" style="margin-top: 1rem;">üö™ –í–∏–π—Ç–∏</button>
  </div>

  <script>
    const form = document.getElementById("profileForm");

    fetch('/api/session')
      .then(res => res.json())
      .then(data => {
        if (!data.user) {
          location.href = '/';
          return;
        }

        const u = data.user;
        document.getElementById("username").value = u.username || "";
        document.getElementById("email").value = u.email || "";
        document.getElementById("age").value = u.age || "";
        document.getElementById("gender").value = u.gender || "";
        document.getElementById("favorite").value = u.favorite || "";
        document.getElementById("avatar").src = 'assets/img/' + (u.avatar || 'default.png');
      });

    form.addEventListener("submit", (e) => {
      e.preventDefault();

      const body = {
        username: form.username.value,
        email: form.email.value,
        age: form.age.value,
        gender: form.gender.value,
        favorite: form.favorite.value
      };

      fetch('/api/update-profile', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert("‚úÖ –ü—Ä–æ—Ñ—ñ–ª—å –æ–Ω–æ–≤–ª–µ–Ω–æ");
          location.reload();
        } else {
          alert(data.error || "‚ùå –ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è");
        }
      });
    });

    function logout() {
      fetch('/api/logout', { method: 'POST' })
        .then(() => location.href = '/');
    }
  </script>
</body>
</html>
